\documentclass[working]{tuftebook}
\input{preamble-gilles.tex}
\usepackage{pdfpages}

\usepackage{lipsum}
\usepackage{parskip}
\usepackage{titletoc}

\usepackage{cmbright}
\usepackage{bm}

\title{Rapport - Read-out Noise, Dark Charge og Signal to Noise Ratio i Princeton Instruments CCD-kamera.}
\author{Albert Lunde, Tinus Blæsbjerg}
\date{Academic year 2020--2021}

\begin{document}
\maketitle
\pagestyle{fancy}
\tableofcontents
\chapter*{Problemformulering}
Vi vil i denne rapport undersøge billeder taget af et CCD Camera fra Princeton Instruments, med henblik på at bestemme kameraets read-out-noise til forskellige indstillinger. I forlængelse af dette, vil vi kigge på, hvordan forholdet er mellem de forskellige read-out-noises, og den usikkerhed der forbundet med den målte poissonfordelte data. Dette vil vi så bruge til at vurdere kameraets kvalitet. Hvis vi bliver færdig med overstående i god tid, vil vi også kigge på, hvordan dark charge giver anledning til mere støj.

\chapter*{Teori}
I denne del beskriver vi teorien bag \textbf{read-out noise}, \textbf{dark charge} og \textbf{signal to noise ratio}. Vi beskriver desuden de statistiske metoder vi har brugt til at beregne usikkerheden på disse størrelser.
\section{Read-out Noise}
\begin{marginfigure}
    \centering
    \incfig{read-out-noise}
    \caption{Read-out-noise: Hver pixel læses lineært af kameraet. Først tømmes øverste række, derefter rykkes næste kollonne op.}
    \label{fig:read-out-noise}
\end{marginfigure}
Et CCD er opbygget af et gitterværk af elektriske brønde. Hver af brøndene svarer til én pixel på det endelige billede som kameraet giver. Når én af disse brønde rammes af en foton, omdanner brønden denne foton til elektrisk ladning. Desto flere ladninger der rammer brønden des større ladning. Når shutteren i kameraet lukkes, oversætter den nu disse ladninger i brøndene til en lysstyrke svarende til størrelsen af ladningen. Støjen kommer rent mekanisk fra designet af kameraet, hvor 
\\
\subsection{Hvad er Read-out Noise?}
Hvad er read-out noise konkret? Ideelt set, så burde to billeder taget med de samme indstillinger være identiske, men dette er ikke tilfældet, hvilket man ville kunne se, hvis man sammenlignede en masse billeder med hinanden. Denne variation i billederne er essensen af read-out-noise, fordi hvis der ingen støj var, så ville billederne netop være ens. Så hvis man estimere denne usikkerhed, så kan man fraregne den fra ens faktisk data, og på den måde få bedre data. 
\\
Hvordan beskriver vi denne støj? Man kan ikke estimere den udfra et billede, men hvis vi har to billeder, som vi kan sammenligne, så kan vi finde ud af, hvad differencen mellem de to billeder er, hvilket vi kan bruge til at estimere, hvad støjen på et billede er. Det skyldes, at når vi kigger på differencen mellem de to billeder, så propagerer vi fejlen fra de enkelte billeder gennem en multivariabel funktion, som vi godt kan finde fejlen på. 
Dette kan fx gøres ved at bruge den calculus-baseret approksimation for en multi-variabel funktion. Funktionen er givet ved:
\[
Z = A - B
.\] 
Fejlen estimeres vha. følgende udtryk:
\begin{align*}
	(\alpha_Z)^2&=\left|   \frac{\partial Z}{\partial A}\right|^2(\alpha_A)^2+\left|   \frac{\partial Z}{\partial B}\right|^2(\alpha_B)^2 \\
	\alpha_Z&=\sqrt{(\alpha_A)^2+(\alpha_B)^2}
.\end{align*}
Fejlen på Z kan nemt beregnes i praksis, fordi man har en masse datapunkter, som man kan finde både middelværdi og spredningen på.
\\
Fejlen på A og B må nødvendigvis være den samme, da de pga samme kameraindstillinger , må komme fra den samme statistiske fordeling. Derfor kan man omskrive udtrykket:
\begin{align*}	
	\alpha_Z&=\sqrt{2(\alpha_A)^2} \\
	\alpha_Z&=\sqrt{2}\cdot \alpha_A \\
	\alpha_A&=\frac{\alpha_Z}{\sqrt{2}}
.\end{align*}

Read-out noise er jo netop den flukturation omkring hvert datapunkt, der gør, at det samme datapunkt på to seperate billeder kan have forskellige værdier. Så et godt estimat for denne støj, vil være spredningen omkring hvert datapunkt. Vi har vist at denne spredning kan findes, hvis man kigger på fejlen i Z. Men fejlen i Z stammer jo også fra den tilfældige flukturation associeret ved støjen af to billeder, derfor er spredningen af Z netop også et godt estimat for fejlen på Z. Med disse antagelser kan vi omskrive udtrykket fra før:
\begin{align*}
	noise&=\frac{\sigma_{Z}}{\sqrt{2}} 
.\end{align*}

Pr. konstruktion af forsøget er der taget 10 billeder med hver indstilling, hvilket betyder, at man kan tage differencen parvis for alle kombinationer af de 10 billeder. Dette giver en masse middelværdier for read-out noise, som vi kan tage middelværdien, for at få et godt estimat af hvad den faktiske read-out noise for et sæt af specifikke indstillinger er. Vi ved, at når vi tager middelværdien af noget data, så er der en usikkerhed forbundet med denne middelværdi, som er givet ved:
\begin{align*}
\alpha = \frac{\sigma_{N-1}}{\sqrt{N}}
\bar{x}\pm \alpha
.\end{align*}
\section{Plotning af data}
Efter vi har beregnet vores read-out noise til forskellige indstillinger, så skal vi også have tolket på vores data. Den bedste måde at gøre dette på, er selvfølgelig ved at plotte dataet. 
\\
\subsection{Enkelte indstillinger}
Vi har gjort os en række overvejelser i forbindelse med plotningen af vores data, fordi vi skal have repræsenteret vores data på en overskuelig måde. Vi kom frem til, at vi gerne ville undersøge, hvordan de enkelte indstillinger påvirker den read-out noise man får ud. Måden vi har valgt at gøre det på, er ved at lave fire forskellige plots, hvor vi i hvert plot undersøger en bestemt indstilling. 
\\
\begin{marginfigure}[-100pt]
    \centering
    \incfig{bins}
    \caption{Kameraet kan indstilles til at udlæse pixels i \textbf{bins}, de mulige indstillinger er vist på figuren; 1x1, 4x4, 8x8 og 20x20. }
    \label{fig:bins}
\end{marginfigure}
Et eksempel kunne fx være \textbf{bin-indstillingen}, hvor man gerne vil undersøge, hvad der sker,når man ændrer på bin størrelsen. rent plotteteknisk gøres dette ved at sortere dataet i en bestemt rækkefølge på forhånd uafhængigt af bin indstillingen. Det betyder, at punkterne med identiske indstillinger på nær bin indstillingen kommer til at ligge over hinanden i plottet. Derefter kan man så farvekode de forskellige bin indstillinger, så man nemt kan se, hvordan ændringen i bins ændrer ens read-out-noise. Dette kan gøres ved alle indstillinger.
\subsubsection*{Bedste indstilling}
Udover at kigge på, hvordan de enkelte indstillinger påvirker read-out noisen, så  vil vi også kigge på alle indstillingerne i et samlet plot. Her vil vi prøve at finde frem til, hvilket sæt af indstillinger, der giver den laveste read-out noise.
\section{Dark Noise}
En anden støj som vi også kan kigge på, er den støj som er forbundet med \textbf{dark current}.
\begin{marginfigure}
\textbf{Dark current:} Elektroner genereres spontant inde i kameraet, hvilket resulterer i en strøm, når man kigger på et tidsinterval og deraf navnet. Den spontane generering af elektroner er stærkt temperaturafhængig, så hvis kameraet køles, reduceres denne strøm.
\end{marginfigure} 
Ved alle målinger med kameraet, hvor man observerer i et tidsrum, vil der være dark current tilstede i ens data. Så i princippet, når man udlæser ens data fra kammeraet, vil en lille del af det signal man måler kommer fra de termisk genererede elektroner. I princippet kan man jo så tage en baggrundsmålling, inden man går videre til det rigtige forsøg. Denne måling kan man så tage højde for, når man laver sine faktiske målinger og på den måde tilnærmelsesvis eliminere bidraget fra dark current. Man vil så ikke helt få elimineret bidraget fra dark current, fordi der er en støj forbundet med denne, heraf \textit{dark noise}. Denne støj kommer af, at dark current afhænger af antal elektroner der er talt. Det betyder, at det er poisson fordelt. 
\\
Når noget er poissonfordelt, så ved vi, at fejlen er givet ved \footnote{Measurements and uncertenties side 30}:
\begin{align*}
\alpha = \sqrt{N} \\
\end{align*}
Det vil sige, at på samme måde som read-out noise, så ville man måle en forskellig dark current, hvis man foretog den samme måling flere gange. 
\\
Vi ved at dark current er temperaturafhængig, hvilket også betyder, at dark noise er temperaturafhængig. Undersøgelser, som ligger uden for målet for denne opgave, viser at hvis man køler kameraet tilstrækkeligt, så er der næsten ikke noget bidrag fra dark noise. Det viser sig, at der er et lineært forhold mellem eksponeringstiden og antal af termisk generede elektroner, hvis temperaturen er konstant. Hvilket måske skal plottes? Plot også dark current med fejl
\section{Sammenligning af dark noise og read-out noise}
Vi kan prøve at lave en sammelinging af, hvilken en af de to faktorer, der bidrager mest til den totalle fejl på ens målte data. Vi ved fra bogen\footnote{Measurements and uncertainties side 41} at: 
\begin{align*}
(\alpha_Z)^2 =(\alpha_Z^A)^2+(\alpha_Z^B)^2 + ...
\end{align*}
Hvilket i vores opgave vil svare til:
\begin{align*}
\alpha_{total} = \sqrt{\alpha_{d-noise}^2 + \alpha_{ro-noise}^2} 
\end{align*}
Det viser sig, at dark noise ikke bidrager specielt meget til den totale støj i forhold til read-out noise, men dette vil vi undersøge dybbere nede i resultaterne.
\section{Vurdering af kamera}


\chapter{Resulater}
\section{Read-out Noise}
Her følger plots af de forskellige indstillinger. Vi har valgt at samle de forskellige parametre i hver deres plot og dermed undersøge den overordnede som disse parametre har på read-out noise.
Et eksempel kunne fx være \textbf{bin-indstillingen}, hvor man gerne vil undersøge, hvad der sker, når man ændrer på bin-størrelsen. Rent plotteteknisk gøres dette ved at sortere dataet i en bestemt rækkefølge på forhånd uafhængigt af bin-indstillinge. Det betyder, at punkterne med identiske indstillinger på nær bin-indstillingen kommer til at ligge over hinanden i plottet. Derefter kan man så farvekode de forskellige bin-indstillinger, så man nemt kan se, hvordan ændringen i bins ændrer ens read-out noise. Dette kan gøres ved alle indstillinger.
\subsubsection*{Bin-Indstilling}
\begin{figure}[ht]
\centering
\sidecaption{Plot af bins}
\includegraphics[width = \textwidth]{../Plots/bins.png}	
\end{figure}
Hvis vi kigger på de røde punkter med bin-indstilling 1x1, så kan vi se, at den generelt har den laveste read-out noise over de fleste indstillinger, udover et par enkelte punkter til sidst. Men en ting man kan bide mærke i, når man kigger på de røde punkter er, at der ikke er en specielt stor fejl på værdierne. Det giver meget god meningen, fordi bin-indstillingen indvirker netop på hvor mange datapunkter der er i hvert billede. Hvis man har et højt antal datapunkter bliver ens måling mere præcis, hvilket betyder at hvert værdien af hvert datapunkt ikke flukturerer lige så meget som højrere bin-indstillinger. Hvis man så fx kigger på 20x20-indstillingen, så er der langt færre datapunkter, hvilket vil sige, at hvert datapunkt indeholder mere information. Det betyder også, at ens data bliver mere upræcis, hvilket så netop både giver anledning til en større read-out noise, men også større fejl på read-out noisen. Værdien for et datapunkt fluktuerer netop pga. af read-out noise, hvis man så har mange punkter indeholdende mindre information, så er flukturationen ikke nær så stor som et mindre antal punkter, ind
\subsubsection*{Quality-Indstilling}
\begin{figure}[ht]
\centering
\sidecaption{Plot af quality}
\includegraphics[width = \textwidth]{../Plots/quality.png}	
\end{figure}

\subsubsection*{Gain-Indstilling}
\begin{figure}[ht]
\centering
\sidecaption{Plot af gain}
\includegraphics[width = \textwidth]{../Plots/gain.png}	
\end{figure}

\subsubsection*{Read-out-rate-Indstilling}
\begin{figure}[ht]
\centering
\sidecaption{Plot af read-out-rate}
\includegraphics[width = \textwidth]{../Plots/read-out-rate.png}	

\end{figure}
\subsection{Bedste indstillinger}
Udover at kigge på, hvordan de enkelte indstillinger påvirker read-out noisen, så  vil vi også gerne kigge på, hvilket sæt af indstillinger der giver den mindste read-out noise. Det vil vi gøre, ved at lave et samlet plot med alle de målte read-out noises på. Vi vil så prøve at estimere, hvilket sæt af indstillinger der giver den laveste read-out noise. De 5 bedste punkter vil vi farvekode, så de adskiller sig fra de andre. Det kunne måske være, at der var en indstilling, der var mere følsom i forhold til at inducere read-out noise. 
\\
Efter analysen kan man måske gå ind og vurdere på hvilken indstilling der er mest følsom overfor read-out noise. 

\section{Vurdering af kamera}
Efter analysen af ens data, kan man måske gå ind og vurdere på, om kameraet er godt nok til det forsøg, som man skal lave med det. Men det er ikke helt meningen med den her rapport
\end{document}
